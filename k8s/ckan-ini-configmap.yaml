apiVersion: v1
kind: ConfigMap
metadata:
  name: ckan-ini-config
  namespace: ckan
data:
  production.ini: |
    [DEFAULT]
    debug = false

    # Database variables
    ckan.db.host = postgres-service
    ckan.db.port = 5432
    ckan.db.name = ckan_default
    ckan.db.user = ckan_default
    ckan.db.password = changeme123

    # Datastore variables
    ckan.datastore.db.host = postgres-service
    ckan.datastore.db.port = 5432
    ckan.datastore.db.name = datastore_default
    ckan.datastore.read_user = datastore_default
    ckan.datastore.read_password = changeme123
    ckan.datastore.write_user = ckan_default
    ckan.datastore.write_password = changeme123

    # Site variables
    ckan.site_url = https://vusta.idist.dev
    ckan.storage_path = /var/lib/ckan/default
    ckan.max_upload_size_mb = 100

    # Redis variables
    ckan.redis.host = redis-service
    ckan.redis.port = 6379
    ckan.redis.db = 0

    # Solr variables
    ckan.solr.host = solr-service
    ckan.solr.port = 8983
    ckan.solr.core = ckan

    # Locale variables
    ckan.locale_default = en
    ckan.locale_order = en vi

    [server:main]
    use = egg:waitress#main
    host = 0.0.0.0
    port = 5000

    [app:main]
    use = egg:ckan
    full_stack = true
    cache_dir = /tmp/%(ckan.site_id)s/
    beaker.session.key = ckan

    # Database connections
    sqlalchemy.url = postgresql://%(ckan.db.user)s:%(ckan.db.password)s@%(ckan.db.host)s:%(ckan.db.port)s/%(ckan.db.name)s
    ckan.datastore.write_url = postgresql://%(ckan.datastore.write_user)s:%(ckan.datastore.write_password)s@%(ckan.datastore.db.host)s:%(ckan.datastore.db.port)s/%(ckan.datastore.db.name)s
    ckan.datastore.read_url = postgresql://%(ckan.datastore.read_user)s:%(ckan.datastore.read_password)s@%(ckan.datastore.db.host)s:%(ckan.datastore.db.port)s/%(ckan.datastore.db.name)s

    # Site settings
    ckan.site_url = https://vusta.idist.dev
    ckan.site_id = default
    ckan.storage_path = /var/lib/ckan/default
    ckan.max_resource_size = 100

    # Redis
    ckan.redis.url = redis://redis-service:6379/0

    # Solr
    solr_url = http://solr-service:8983/solr/ckan

    # Plugins
    ckan.plugins = stats text_view image_view datastore

    # Locale
    ckan.locale_default = en
    ckan.locale_order = en vi
    ckan.locales_offered = en vi
    ckan.locales_filtered_out = en_GB

    # Security
    SECRET_KEY = changeme-generate-random-secret-key-for-flask
    ckan.auth.anon_create_dataset = false
    ckan.auth.create_unowned_dataset = false
    ckan.auth.create_dataset_if_not_in_organization = false
    ckan.auth.user_create_groups = false
    ckan.auth.user_create_organizations = false
    ckan.auth.user_delete_groups = false
    ckan.auth.user_delete_organizations = false
    ckan.auth.create_user_via_api = false
    ckan.auth.create_user_via_web = true
    ckan.auth.roles_that_cascade_to_sub_groups = admin

    # Search
    ckan.site_title = CKAN Data Portal
    ckan.site_logo = /base/images/ckan-logo.png
    ckan.site_description = Open Data Portal
    ckan.favicon = /base/images/ckan.ico
    ckan.gravatar_default = identicon
    ckan.preview.direct = png jpg gif
    ckan.preview.loadable = html htm rdf+xml owl+xml xml n3 n-triples turtle plain atom csv tsv rss txt json

    # Resource Proxy
    ckan.resource_proxy.max_file_size = 1048576
    ckan.resource_proxy.chunk_size = 4096

    # Activity Streams
    ckan.activity_streams_enabled = true
    ckan.activity_list_limit = 31
    ckan.activity_streams_email_notifications = true
    ckan.email_notifications_since = 2 days

    # Feeds
    ckan.feeds.authority_name =
    ckan.feeds.date =
    ckan.feeds.author_name =
    ckan.feeds.author_link =

    # Internationalisation
    ckan.display_timezone = Asia/Ho_Chi_Minh

    # Logging
    [loggers]
    keys = root, ckan, ckanext, werkzeug

    [handlers]
    keys = console

    [formatters]
    keys = generic

    [logger_root]
    level = WARNING
    handlers = console

    [logger_ckan]
    level = INFO
    handlers = console
    qualname = ckan
    propagate = 0

    [logger_ckanext]
    level = INFO
    handlers = console
    qualname = ckanext
    propagate = 0

    [logger_werkzeug]
    level = WARNING
    handlers = console
    qualname = werkzeug
    propagate = 0

    [handler_console]
    class = StreamHandler
    args = (sys.stderr,)
    level = NOTSET
    formatter = generic

    [formatter_generic]
    format = %(asctime)s %(levelname)-5.5s [%(name)s] %(message)s

